@page "/"
@using BlazorApp.Models
@using Common.Classes
@using Common.Discord
@using Common.Pingg
@using Microsoft.AspNetCore.Authorization
@using Microsoft.Extensions.Options
@attribute [Authorize]
@inject IOptions<List<CameraConfig>> CamerasOptions
@inject PingService PingService
@inject ILogger<Home> Logger
@inject IDiscordWebHookService DiscordWebHookService
@rendermode InteractiveServer

<PageTitle>Cameras Monitor</PageTitle>

<div class="page-wrapper">
    <header>
        <a href="/logout" class="btn-logout" title="Se deconnecter">Deconnexion</a>
        <div class="logo">
            <div class="logo-icon">üè†</div>
            <span>The house of tonito !</span>
        </div>
        <p class="subtitle">Les cameras</p>
    </header>

    <main>
        <div class="card">
            <div class="card-header">
                <p class="card-description">Systeme de surveillance de renards, pigeons, pies, chats et autres trucs tr√®s utiles.</p>
            </div>

            <div class="camera-grid">
                @{ var index = 0; }
                @foreach (var camera in _cameras)
                {
                    var status = _pingResults.GetValueOrDefault(camera.Name);
                    var isLoading = _loadingStates.GetValueOrDefault(camera.Name);
                    var colorClass = index % 2 == 0 ? "color-red" : "color-blue";

                    <div class="camera-card @colorClass">
                        <div class="camera-icon">üì∑</div>
                        <div class="camera-info">
                            <div class="camera-name">@camera.Name</div>
                            <div class="camera-status">
                                @if (isLoading)
                                {
                                    <span class="status-dot loading"></span>
                                    <span>Ping en cours...</span>
                                }
                                else if (status == true)
                                {
                                    <span class="status-dot online"></span>
                                    <span>En ligne</span>
                                }
                                else if (status == false)
                                {
                                    <span class="status-dot offline"></span>
                                    <span>Hors ligne</span>
                                }
                                else
                                {
                                    <span class="status-dot unknown"></span>
                                    <span>Statut inconnu</span>
                                }
                            </div>
                        </div>
                        <div class="camera-actions">
                            <button class="btn-ping" @onclick="() => PingCamera(camera)" disabled="@isLoading" title="Ping">
                                üîÑ
                            </button>
                            <a href="@camera.Url" @onclick="() => LogToDiscord(camera)" target="_blank" rel="noopener noreferrer" class="btn-link" title="Ouvrir">
                                ‚Üí
                            </a>
                        </div>
                    </div>
                    index++;
                }
            </div>

            <div class="info-banner">
                <div class="info-banner-content">
                    <span>‚è≥</span>
                    <span>Le chargement du flux peut prendre quelques secondes</span>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <span>¬© Tonito</span>
    </footer>
</div>
